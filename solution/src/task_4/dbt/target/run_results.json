{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.8.9", "generated_at": "2024-11-23T00:41:33.342692Z", "invocation_id": "7fb24b08-bc58-4806-a26e-8e6e976dcfb4", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-23T00:41:33.114179Z", "completed_at": "2024-11-23T00:41:33.129179Z"}, {"name": "execute", "started_at": "2024-11-23T00:41:33.129179Z", "completed_at": "2024-11-23T00:41:33.308686Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.19750595092773438, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.task_4.calculate_comissions", "compiled": true, "compiled_code": "WITH orders_with_salesowners AS (\r\n    SELECT\r\n        o.order_id,\r\n        round(i.gross_value / 100.0, 2) AS gross_value_in_euros,\r\n\r\n        -- Converting the gross value into net value by taking the vat out in a non-lineal way.\r\n        round((i.gross_value / 100.0) / (1 + i.vat / 100.0), 2) AS net_value_in_euros,\r\n        string_to_array(o.salesowners, ', ') AS salesowners_array\r\n    FROM\r\n        public.orders o\r\n    JOIN\r\n        public.invoicing_data i ON o.order_id = i.order_id\r\n),\r\nsalesowners AS (\r\n    SELECT\r\n        ows.order_id,\r\n        ows.net_value_in_euros,\r\n        so.salesowner,\r\n        so.ordinality AS salesowner_position\r\n    FROM\r\n        orders_with_salesowners ows,\r\n        unnest(ows.salesowners_array) WITH ORDINALITY AS so(salesowner, ordinality) -- unnests the array and assigns the order for each sales person in the order that it comes from the file\r\n),\r\ncommission_calc AS (\r\n    SELECT\r\n        order_id,\r\n        salesowner,\r\n        CASE \r\n            WHEN salesowner_position = 1 THEN net_value_in_euros * 0.06    -- Main owner - 6%\r\n            WHEN salesowner_position = 2 THEN net_value_in_euros * 0.025   -- Co-owner 1 - 2.5%\r\n            WHEN salesowner_position = 3 THEN net_value_in_euros * 0.0095  -- Co-owner 2 - 0.95%\r\n            ELSE 0  -- No comission\r\n        END AS commission\r\n    FROM salesowners\r\n)\r\nSELECT\r\n    salesowner,\r\n    ROUND(SUM(commission), 2) AS total_commission\r\nFROM commission_calc\r\nGROUP BY salesowner\r\nORDER BY total_commission DESC", "relation_name": "\"data_engineering_test\".\"public\".\"calculate_comissions\""}], "elapsed_time": 2.2273972034454346, "args": {"exclude": [], "log_level": "info", "write_json": true, "require_resource_names_without_spaces": false, "profiles_dir": "C:\\Users\\nicol\\Desktop\\ifco-assessment\\data-engineering-test\\solution\\src\\task_4/dbt", "log_format_file": "debug", "defer": false, "log_file_max_bytes": 10485760, "project_dir": "C:\\Users\\nicol\\Desktop\\ifco-assessment\\data-engineering-test\\solution\\src\\task_4/dbt", "static_parser": true, "send_anonymous_usage_stats": true, "invocation_command": "dbt run --profiles-dir C:\\Users\\nicol\\Desktop\\ifco-assessment\\data-engineering-test\\solution\\src\\task_4/dbt --project-dir C:\\Users\\nicol\\Desktop\\ifco-assessment\\data-engineering-test\\solution\\src\\task_4/dbt", "log_level_file": "debug", "enable_legacy_logger": false, "use_colors": true, "print": true, "warn_error_options": {"include": [], "exclude": []}, "partial_parse_file_diff": true, "select": [], "macro_debugging": false, "log_format": "default", "source_freshness_run_project_hooks": false, "vars": {}, "favor_state": false, "use_colors_file": true, "show_resource_report": false, "partial_parse": true, "require_explicit_package_overrides_for_builtin_materializations": true, "strict_mode": false, "indirect_selection": "eager", "which": "run", "empty": false, "quiet": false, "introspect": true, "log_path": "C:\\Users\\nicol\\Desktop\\ifco-assessment\\data-engineering-test\\solution\\src\\task_4\\dbt\\logs", "version_check": true, "populate_cache": true, "cache_selected_only": false, "printer_width": 80}}