{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.8.8", "generated_at": "2024-11-22T03:10:39.448209Z", "invocation_id": "5bdd7902-4bcf-484f-a30c-ca0ea8d055b5", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-22T03:10:39.240225Z", "completed_at": "2024-11-22T03:10:39.246230Z"}, {"name": "execute", "started_at": "2024-11-22T03:10:39.246230Z", "completed_at": "2024-11-22T03:10:39.421665Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.18367528915405273, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.task_4.calculate_comissions", "compiled": true, "compiled_code": "WITH orders_with_salesowners AS (\r\n    SELECT\r\n        o.order_id,\r\n        i.gross_value / 100.0 AS gross_value_in_euros,\r\n\r\n        -- Converting the gross value into net value by taking the vat out in a non-lineal way.\r\n        (i.gross_value / 100.0) / (1 + i.vat / 100.0) AS net_value_in_euros,\r\n        string_to_array(o.salesowners, ', ') AS salesowners_array\r\n    FROM\r\n        public.orders o\r\n    JOIN\r\n        public.invoicing_data i ON o.order_id = i.order_id\r\n),\r\nsalesowners AS (\r\n    SELECT\r\n        ows.order_id,\r\n        ows.net_value_in_euros,\r\n        so.salesowner,\r\n        so.ordinality AS salesowner_position\r\n    FROM\r\n        orders_with_salesowners ows,\r\n        unnest(ows.salesowners_array) WITH ORDINALITY AS so(salesowner, ordinality) -- unnests the array and assigns the order for each sales person in the order that it comes from the file\r\n),\r\ncommission_calc AS (\r\n    SELECT\r\n        order_id,\r\n        salesowner,\r\n        CASE \r\n            WHEN salesowner_position = 1 THEN net_value_in_euros * 0.06    -- Main owner - 6%\r\n            WHEN salesowner_position = 2 THEN net_value_in_euros * 0.025   -- Co-owner 1 - 2.5%\r\n            WHEN salesowner_position = 3 THEN net_value_in_euros * 0.0095  -- Co-owner 2 - 0.95%\r\n            ELSE 0  -- No comission\r\n        END AS commission\r\n    FROM salesowners\r\n)\r\nSELECT\r\n    salesowner,\r\n    ROUND(SUM(commission), 2) AS total_commission\r\nFROM commission_calc\r\nGROUP BY salesowner\r\nORDER BY total_commission DESC", "relation_name": "\"data_engineering_test\".\"public\".\"calculate_comissions\""}], "elapsed_time": 0.38977861404418945, "args": {"vars": {}, "strict_mode": false, "use_colors_file": true, "quiet": false, "show_resource_report": false, "project_dir": "C:\\Users\\nicol\\Desktop\\ifco-assessment\\data-engineering-test\\solution\\src\\task_4/dbt", "require_explicit_package_overrides_for_builtin_materializations": true, "populate_cache": true, "select": [], "profiles_dir": "C:\\Users\\nicol\\Desktop\\ifco-assessment\\data-engineering-test\\solution\\src\\task_4/dbt", "printer_width": 80, "source_freshness_run_project_hooks": false, "defer": false, "warn_error_options": {"include": [], "exclude": []}, "which": "run", "log_level_file": "debug", "macro_debugging": false, "write_json": true, "cache_selected_only": false, "print": true, "require_resource_names_without_spaces": false, "log_level": "info", "log_path": "C:\\Users\\nicol\\Desktop\\ifco-assessment\\data-engineering-test\\solution\\src\\task_4\\dbt\\logs", "send_anonymous_usage_stats": true, "static_parser": true, "log_format": "default", "introspect": true, "indirect_selection": "eager", "partial_parse": true, "version_check": true, "log_format_file": "debug", "enable_legacy_logger": false, "favor_state": false, "partial_parse_file_diff": true, "exclude": [], "log_file_max_bytes": 10485760, "empty": false, "invocation_command": "dbt run --profiles-dir C:\\Users\\nicol\\Desktop\\ifco-assessment\\data-engineering-test\\solution\\src\\task_4/dbt --project-dir C:\\Users\\nicol\\Desktop\\ifco-assessment\\data-engineering-test\\solution\\src\\task_4/dbt", "use_colors": true}}